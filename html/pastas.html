<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tiyapuy</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="main.css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div class="App paso1">
      <header class="App-header">
        <img src="img/1.png" class="App-logo" alt="logo" />
      </header>
      <img
        src="https://firebasestorage.googleapis.com/v0/b/tiyapuy.appspot.com/o/BlockchainPasta02.jpg?alt=media&amp;token=60184017-e688-41dc-809f-b580a8c43fca"
        class="video"
        alt="logo"
      />
      <div class="hexagono1 text-center center">CONOCE NUESTRA HISTORIA</div>

      <div class="hexagono1after"></div>
      <p class="parrafo">
        Todo el proceso detrás del producto que <br />tienes en tus manos está
        documentado <br />y certificado por <b>Blockchain</b>.
      </p>
      <div class="linea"></div>

      <p
        style="
          font-size: calc(6px + 2vmin);
          margin-top: 4vh;
          color: rgb(79, 79, 79);
        "
      >
        <b>INGRESA EL <a class="App-link">CÓDIGO DEL LOTE</a></b
        ><svg
          width="1.5em"
          height="1.5em"
          viewBox="0 0 16 16"
          class="icon bi bi-exclamation-diamond-fill"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            d="M9.05.435c-.58-.58-1.52-.58-2.1 0L.436 6.95c-.58.58-.58 1.519 0 2.098l6.516 6.516c.58.58 1.519.58 2.098 0l6.516-6.516c.58-.58.58-1.519 0-2.098L9.05.435zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"
          ></path>
        </svg>
      </p>

      <input class="input" placeholder="QL3-001" value="" id="lote" />
      <p class="error">
        <svg
          width="1em"
          height="1em"
          viewBox="0 0 16 16"
          class="bi bi-exclamation-triangle-fill"
          fill="currentColor"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill-rule="evenodd"
            d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 5zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"
          ></path>
        </svg>
        &nbsp; Sorry, código invalido. Vuelve a intentarlo
      </p>
      <div class="hexagonobefore"></div>
      <button
        type="button"
        class="hexagono btn btn-link"
        onclick="consultarLote()"
      >
        VERIFICAR
      </button>
      <div class="hexagonoafter"></div>
    </div>

    <div class="App paso2">
      <header class="App-header">
        <img src="img/1.png" class="App-logo" alt="logo" />
      </header>
      <div class="fondo">
        <div style="color: dimgray; width: 85%">
          <div class="hexagonobeforeApp"></div>
          <div class="headerApp resLote"></div>
          <div
            class="App"
            style="border: 3px solid rgb(183, 159, 115); width: 100%"
          >
            <b
              ><p class="margin-horizontal">¡Soy un producto Blockchain!</p>
              <div class="lineagris" style="margin-bottom: 3vh"></div
            ></b>

            <div class="divList">
              <ul class="text-left">
                <li class="mt10 list_data variedad_papa">
                  <strong>Variedad de papa:</strong> <br />
                </li>
                <li class="mt10 list_data procedenciaPapa">
                  <strong>Procedencia de lote de papa nativa:</strong> <br />
                  <!-- PUCARA / CHONTACA / 3887 msnm -->
                </li>
                <li class="mt10 list_data duenoSuelo">
                  <strong>Nombre del Agricultor:</strong> <br />
                  <!-- Tineo Gómez, Eustaquio -->
                </li>
                <li class="mt10 list_data ubicacionGeo">
                  <strong>Ubicación geográfica de la zona de siembra:</strong>
                  <br />
                  <!-- PUCARA / CHONTACA -->
                </li>
                <li class="mt10 list_data caractSembrar">
                  <strong>Características de la siembra:</strong> <br />
                  <!-- Semilla orgánica, trabajado en base a las BPA -->
                </li>
                <li class="mt10 list_data fecha_cosecha">
                  <strong>Fecha de cosecha:</strong> <br />
                </li>
              </ul>
            </div>

            <p class="margin-horizontal listInd resId"></p>

            <p class="listInd"><b>¿Quieres saber más de esta historia?</b></p>

            <a href="https://www.instagram.com/tiyapuy_foods/" target="_blank">
              <img
                src="img/instagram.png"
                alt="logo"
                style="width: 90%; margin-bottom: 3vh; margin-top: 3vh"
              />
            </a>
          </div>
        </div>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-firestore.js"></script>
    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyA784Oz5Mb_6yGB7ZtfWY3Oms5cw_Z2pzU",
    authDomain: "prueba-tiyapuy.firebaseapp.com",
    projectId: "prueba-tiyapuy",
    storageBucket: "prueba-tiyapuy.appspot.com",
    messagingSenderId: "854994069948",
    appId: "1:854994069948:web:cc3721ba9a17d0f39b63b9",
    measurementId: "G-QDKWWZ131J"


      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      const db = firebase.firestore();

      const resId = document.querySelector(".resId");
      const resLote = document.querySelector(".resLote");
      const resFechaCosecha = document.querySelector(".fecha_cosecha");
      const resVariedadPapa = document.querySelector(".variedad_papa");
      const procedenciaPapa = document.querySelector(".procedenciaPapa");
      const duenoSuelo = document.querySelector(".duenoSuelo");
      const caractSembrar = document.querySelector(".caractSembrar");
      const ubicacionGeo = document.querySelector(".ubicacionGeo");

      const consultarLote = () => {
        const inputLote = document.getElementById("lote").value;
        // con esto consultamos los datos
        var productos = db
          .collection("productos")
          .where("lote", "==", inputLote)
          .where("estado", "==", "complet");

        productos
          .get()
          .then(function (querySnapshot) {
            //console.log(querySnapshot.docs.length);
            if (querySnapshot.docs.length > 0) {
              document.querySelector(".error").style.display = "none";
              document.querySelector(".paso1").style.display = "none";
              document.querySelector(".paso2").style.display = "block";

              querySnapshot.forEach(function (doc) {
                const response = doc.data();
                let date = new Date(response.proceso_4.fecha_escarbar_mp);
                resId.innerHTML = `<b>ID de Registro: &nbsp;</b> ${response.lote}`;
                resLote.innerText = `LOTE: ${response.lote}`;
                resFechaCosecha.innerHTML += date.toLocaleString();
                resVariedadPapa.innerHTML += `${response.proceso_2.semilla.origen}`;
                duenoSuelo.innerHTML += `${response.proceso_1.suelo.dueno}`;
                caractSembrar.innerHTML += `${response.proceso_2.insumo.caracteristicas}`;
                ubicacionGeo.innerHTML += `${response.proceso_1.suelo.ubicacion}`;
                procedenciaPapa.innerHTML += `${response.proceso_1.suelo.ubicacion} / ${response.proceso_1.suelo.altitud}`;
              });
            } else {
              document.querySelector(".error").style.display = "block";
              //console.log("no se ha encontrado coincidencias");
            }
          })
          .catch((error) => {
            console.log("no hay nada", error);
          });
      };

      const inputLotePress = document.getElementById("lote");
      inputLotePress.addEventListener("keypress", () => {
        document.querySelector(".error").style.display = "none";
      });
    </script>
  </body>
</html>
